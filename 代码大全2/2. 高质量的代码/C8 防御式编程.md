# 防御式编程

## 8.1 保护程序，使其免受无效输入的影响

一般有三种方法来处理：

检查来源于外部的所有数据的值

检查子程序所有输入参数的值

决定如何处理错误的输入数据

## 8.2 断言

自己构建断言机制

```cpp
#define ASSERT( condition, message ) {     \
    if ( !(condition) ) {                  \
	LogError( "Assertion failed: ",    \
		#condition, message );     \
	exit( EXIT_FAILURE );              \
    }                                      \
}                                          \
```

### 使用断言的指导原则

用错误处理代码来处理预期会发生的情况；用断言来处理永远不应该发生的情况

避免将要执行的代码放到断言中

使用断言来声明和验证前置条件和后置条件

对健壮性要求很高的代码，应先使用断言再处理错误

## 8.3 错误处理技术

返回中立值

换用下一条有效数据

返回与上次相同的答案

换用最接近的合法值

在文件中记录警告信息

返回一个错误代码

调用错误处理子程序或对象

在遇到错误的地方显示出错消息

用最妥当的方式在局部处理错误

关闭程序

### 健壮性与正确性

### 高层级设计对错误处理方式的影响

## 8.4 异常

使用异常来通知程序其他部分不应忽略的错误

仅在真正异常的情况下才抛出异常

不要使用异常来推卸责任

除非是在同一位置捕获，否则避免在构造函数和析构函数中抛出异常
