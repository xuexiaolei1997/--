# 代码调优策略

## 25.1 性能概述

### 质量特性和性能

### 性能和代码调优

从以下每个角度考虑效率：

* 程序需求、程序设计
* 类和子程序设计
* 操作系统交互
* 代码编译
* 硬件
* 代码调优

## 25.2 代码调优简介

## 25.3 各式各样的臃肿和蜜糖

### 效率低下的常见根源

输入/输出操作

分页

系统调用

解释型语言

错误

## 25.4 度量

### 度量须精确

## 25.5 迭代

## 25.6 代码调优方法总结

1. 使用良好设计的代码来开发软件，使其易于理解和修改
2. 如果性能很差，则采取以下操作。
   1. 保存一个能正常工作的版本，以便能回到”最后已知良好状态“
   2. 度量系统以找到热点。
   3. 确定性能低下是否来自于设计、数据类型或算法的不足，以及是否适合代码调优。如果不适合代码调优，返回步骤1.
   4. 对步骤（3）中确定的瓶颈进行调优。
   5. 逐一度量每一项改进。
   6. 如果每一项改进没有提升代码性能，就恢复步骤（1）保存的代码。通常，超过半数的性能调优只能产生微不足道的性能改进，甚至会降低性能。
3. 从第2步开始重复。

> 检查清单：代码调优策略
>
> | 项           | 具体内容                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
> | ------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
> | 程序整体性能 | 考虑通过变更程序需求来提升性能了吗？<br />考虑通过修改程序设计来提升性能了吗？<br />考虑通过修改类的设计来提升性能了吗？<br />考虑通过避免程序与操作系统的交互来提升性能了吗？<br />考虑通过避免I/O来提升性能了吗？<br />考虑用编译型语言来替代解释型语言来提升性能了吗？<br />考虑启用编译器优化选项来提升性能了吗？<br />考虑通过切换到不同的硬件设备来提升性能了吗？<br />代码调优是不是万不得已的最后选择？                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
> | 代码调优方法 | 开始代码调优之前，程序是完全正确的吗？<br />在代码调优之前，度量过性能瓶颈了吗？<br />度量过每一次代码调优的效果了吗？<br />如果带啊吗调优并没有带来预期的性能提升，是否已撤销所有的改动？<br />是否尝试过针对每一个性能瓶颈进行多次修改以提升性能（换言之，迭代过吗）？<br />性能只是整体软件质量的一个方面，而且通常并不是最重要的。精心调优的代码只是整体性能的一个方面，而且通常并不是最重要的。相较于代码的效率，程序的架构设计、详细设计以及数据结构和算法的选择对陈虚谷的执行速度和规模通常有更大的影响。<br />定量度量是实现性能最大化的关键。它是找出能真正提高性能的地方的必要手段。另外，为了验证优化是提升了性能而不是降级，还需要再次进行定量度量。<br />大多数程序的大部分时间都花在一小部分代码上。除非亲自度量，否则不会直到是哪些代码。<br />通常需要多次迭代才能通过代码调优达到预期的性能提升。<br />最开始编码时，为性能工作做好准备的最佳方式就是编写易于理解和修改的清晰的代码。 |
