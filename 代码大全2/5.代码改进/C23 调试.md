# 调试

## 23.1 调试问题概述

### 调试在软件质量中的作用

与测试一样，调试本身并不是提高软件质量的方法，而是一种判断缺陷的方法。

### 不同调试技能水平的差异

### 缺陷即机会

理解自己要编写的程序

理解自己犯下的错误属于什么类型

从代码阅读者的角度理解代码质量

从解决问题的方法中学习

从解决缺陷的方法中学习

### 无效的方法

靠猜来发现缺陷

不要浪费时间去理解问题

用最明显的方法修复错误

迷信调试

## 23.2 发现缺陷

调试的科学方法：

1. 复现错误。
2. 定位错误（”故障“）的根源。
   a. 收集产生缺陷的数据。
   b. 分析已收集的数据，并形成关于缺陷的假设
   c. 通过测试程序或检查代码，确定如何证明或证伪假设。
   d. 使用上个步骤中的方法来证明或证伪假设。
3. 修复缺陷。
4. 测试已修复的程序。
5. 寻找类似的错误。

### 查出缺陷的小技巧

使用所有可用的数据来做出假设

精炼产生错误的测试用例

在单元测试套件中运行代码

使用可用的工具

用不同的几种方法重现错误

生成更多数据来陈胜更多的假设

头脑风暴找出可能的假设

在桌子旁边放个记事本，把要尝试的事情列个清单

缩小可疑的代码区域

以前有缺陷的类和子程序值得怀疑

检查最近变更的代码

扩大可以的代码区域

逐步集成

检查常见缺陷

向别人讲述

放下问题，休息一下

### 暴力调试

暴力是调试软件问题时经常被忽视的方法。暴力是指一种技术，它可能是乏味的、困难的、耗时的，但肯定能解决问题。

* 对被破坏的代码进行完整的设计或代码评审
* 丢弃部分代码，并进行重新设计或重新编码
* 丢弃整个程序，并进行重新设计或重新编码
* 编译带有完整调试信息的代码
* 以最挑剔的警告级别编译代码，并修复所有挑剔的编译器警告
* 使用单元测试工具并单独测试新代码
* 写一个自动化测试陶家，然后通宵运行
* 在调试器中手动单步执行大范围的代码，直到出现错误。
* 使用print、display或其他日志语句来检测代码
* 使用不同的编译器来编译代码
* 在不同的环境中编译和运行程序
* 针对特殊的库或执行环境连接或运行代码，当代码被错误使用时会产生警告。
* 复制最终用户的全部机器配置
* 将新代码一小块一小块地集成，并在集成时对每一块进行全面测试。

为快而糙的调试设置最大时间

拟一个暴力技术的清单

### 语法错误

不要相信编译器消息中的行号

不要相信编译器消息

不要相信编译器的第二条消息

分而治之

查找放错位置的注释和引号

## 23.3 修复缺陷

在修复前先理解问题

理解程序，而不仅仅是问题

确认缺陷诊断结论

放松

保存原始代码

修复问题，而不是症状

仅有充分理由的情况下修改代码

一次只改一处

检查修复的程序

添加一个暴露缺陷的单元测试

寻找类似的缺陷

## 23.4 调试中的心理因素

## 23.5 那些显而易见和不太明显的调试工具

### 源代码比较工具

### 编译器告警信息

将编译器的告警级别设置为可能的最高、最挑剔的级别并修复它报告的错误

将告警视为错误

设置项目范围的编译时选项标准

### 扩展语法和逻辑检查

### 代码执行分析工具

### 测试框架/脚手架

### 调试工具

> 检查清单:调试要点
>
> | 项             | 具体内容                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
> | -------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
> | 发现缺陷的技术 | 使用所有可用的数据来创建假设<br />精炼产生错误的测试用例<br />在单元测试套件中运行代码<br />使用可用的工具<br />使用不同的方法重现错误<br />生成更多的数据以产生更多的假设<br />利用负面测试的结果<br />头脑风暴找出可能的假设<br />在桌子旁边放一个记事本，把要尝试的事情都列出来<br />缩小可疑的代码区域<br />以前有缺陷的类和子程序值得怀疑<br />检查最近修改的代码<br />扩大可疑的代码区域<br />逐步集成<br />检查常见的缺陷<br />向某人讲述发现的问题<br />把问题放一放，先休息一下<br />为快而糙的调试设置最大时间<br />整理一个暴力技术的清单，并且使用它们 |
> | 语法错误的技术 | 不要相信编译器消息中的行号<br />不要相信编译器消息<br />不要相信编译器的第二条消息<br />分而治之<br />使用语法制导编辑器来发现错误的注释和引号                                                                                                                                                                                                                                                                                                                                                                                                                     |
> | 修复缺陷的技术 | 在修复前先理解问题<br />理解程序，而不仅仅是问题<br />确认缺陷诊断结论<br />放松<br />保存原始代码<br />修复问题，而不是症状<br />仅在有充分理由的情况下修改代码<br />一次只做一处修改<br />检查修复的程序<br />添加一个暴露缺陷的单元测试<br />寻找类似的缺陷                                                                                                                                                                                                                                                                                                     |
> | 常用的调试方法 | 你是否将调试作为了解程序、错误、代码质量和解决问题方法的机会？<br />你是否避免了试错、迷信的调试方法？<br />你是否假设错误是你犯错导致的？<br />你是否使用科学的方法来复现间歇性错误？<br />你是否使用科学的方法来发现缺陷？<br />你不是每次都使用相同的方法，而是使用几种不同的技术来发现缺陷吗？<br />你是否验证了修复的正确性？<br />你是否使用了编译器告警消息、执行分析结果、测试框架、脚手架和交互式调试？                                                                                                                                                   |
